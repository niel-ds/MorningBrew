<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Café Matinal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --espresso:#4B2B1E; --espresso-2:#3a2218;
      --latte:#E3D5C6; --cream:#F5F0EB; --copper:#B87333;
    }
    html,body{height:100%}
    body{font-family:'Inter',sans-serif;background:var(--cream);color:var(--espresso);-webkit-tap-highlight-color:transparent}
    .serif{font-family:'Playfair Display',serif}
    .card{background:#fff;border-radius:1.25rem;box-shadow:0 6px 28px rgba(0,0,0,.08)}
    .dark-mode{background:#121212;color:#fff}
    .dark-mode .card{background:#1E1E1E;box-shadow:0 6px 28px rgba(255,255,255,.06)}
    .progress{height:8px;border-radius:999px;background:rgba(0,0,0,.08)}
    .progress > span{display:block;height:100%;border-radius:inherit;background:var(--copper);transition:width .35s ease}
    .title-xl{font-size:clamp(1.1rem, 1rem + 1vw, 1.35rem)}
    .quote-lg{font-size:clamp(1.15rem, 1rem + 1.2vw, 1.5rem);line-height:1.35}
    .tappable{min-height:44px;min-width:44px}
    .focus-ring:focus-visible{outline:2px solid var(--copper);outline-offset:3px;border-radius:.75rem}
    .safe-bottom{padding-bottom:env(safe-area-inset-bottom, 0)}
    .icon{width:24px;height:24px;stroke:currentColor;stroke-width:1.75;fill:none}
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="w-full bg-[color:var(--espresso)] text-[color:var(--cream)]">
    <div class="mx-auto w-full max-w-screen-md px-4 sm:px-6 py-3 flex items-center justify-between">
      <h1 class="font-semibold" style="font-size:clamp(1rem,.9rem + .8vw,1.25rem)">Café Matinal</h1>
      <div class="flex items-center gap-2">
        <button id="themeToggle" class="tappable focus-ring px-2 py-1 rounded text-[color:var(--cream)]" title="Tema">
          <svg class="icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
        <button id="langToggle" class="tappable focus-ring px-2 py-1 rounded text-[color:var(--cream)] font-semibold" title="Idioma">EN/PT</button>
      </div>
    </div>
  </header>

  <!-- HOME -->
  <main id="homeScreen" class="flex-1 w-full mx-auto max-w-screen-lg px-4 sm:px-6 py-4 space-y-6">
    <!-- Quote -->
    <section class="card p-5 sm:p-6">
      <div class="flex items-center gap-3 mb-3">
        <div class="rounded-full bg-[color:var(--latte)] p-2">
          <svg class="icon text-[color:var(--espresso)]" viewBox="0 0 24 24"><path d="M3 8h14a4 4 0 0 0 0 8H7a4 4 0 0 1-4-4V8Z"/><path d="M17 8h2a3 3 0 0 1 0 6h-2"/></svg>
        </div>
        <h2 class="title-xl font-semibold">Café de Hoje</h2>
      </div>
      <blockquote class="serif quote-lg italic mb-3" id="quoteText">“O segredo para avançar é começar.”</blockquote>
      <p class="text-right text-sm text-[color:var(--copper)]" id="quoteAuthor">— Mark Twain</p>
    </section>

    <!-- Streak -->
    <section class="rounded-2xl px-5 py-4 sm:py-5 text-[color:var(--cream)]"
             style="background:linear-gradient(135deg, var(--espresso-2), var(--espresso))">
      <div class="flex items-center justify-between gap-4">
        <div>
          <h3 class="font-semibold">Sequência Matinal</h3>
          <p class="text-sm/relaxed opacity-90">Sem redes sociais antes do meio-dia</p>
        </div>
        <div class="serif" style="font-size:clamp(1.75rem,1.2rem + 2vw,2.25rem)">7</div>
      </div>
    </section>

    <!-- Rotina Matinal -->
    <section class="card p-5 sm:p-6">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-3">
          <div class="rounded-full bg-[color:var(--latte)] p-2">
            <svg class="icon text-[color:var(--espresso)]" viewBox="0 0 24 24"><path d="M3 5h18M7 3v4M17 3v4M6 10h12M6 14h12M6 18h12"/></svg>
          </div>
          <h2 class="title-xl font-semibold">Rotina Matinal</h2>
        </div>
        <button id="addMorningTask" class="tappable focus-ring px-3 py-2 rounded text-[color:var(--copper)] border-2 border-[color:var(--copper)]">+ Item</button>
      </div>

      <div class="progress mb-4"><span id="routineProgress" style="width:0%"></span></div>

      <ul id="morningList" class="space-y-2"><!-- itens --></ul>
    </section>

    <!-- Planner -->
    <section class="card p-5 sm:p-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="rounded-full bg-[color:var(--latte)] p-2">
          <svg class="icon text-[color:var(--espresso)]" viewBox="0 0 24 24"><path d="M8 2v4M16 2v4M3 10h18M5 6h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"/></svg>
        </div>
        <h2 class="title-xl font-semibold">Planejamento Diário</h2>
      </div>

      <div class="grid sm:grid-cols-3 gap-4">
        <div>
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold text-[color:var(--copper)]">Manhã</h3>
            <button data-add="morning" class="tappable focus-ring px-3 py-1.5 rounded border-2 border-[color:var(--copper)] text-[color:var(--copper)]">+Adicionar</button>
          </div>
          <ul id="planMorning" class="space-y-2" data-period="morning"></ul>
        </div>
        <div>
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold text-[color:var(--copper)]">Tarde</h3>
            <button data-add="afternoon" class="tappable focus-ring px-3 py-1.5 rounded border-2 border-[color:var(--copper)] text-[color:var(--copper)]">+Adicionar</button>
          </div>
          <ul id="planAfternoon" class="space-y-2" data-period="afternoon"></ul>
        </div>
        <div>
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold text-[color:var(--copper)]">Noite</h3>
            <button data-add="evening" class="tappable focus-ring px-3 py-1.5 rounded border-2 border-[color:var(--copper)] text-[color:var(--copper)]">+Adicionar</button>
          </div>
          <ul id="planEvening" class="space-y-2" data-period="evening"></ul>
        </div>
      </div>
    </section>
  </main>

  <!-- ROTINAS -->
  <section id="routineScreen" class="hidden flex-1 w-full mx-auto max-w-screen-md px-4 sm:px-6 py-4">
    <div class="card w-full p-5 sm:p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="title-xl font-semibold">Minhas Rotinas</h2>
        <button id="addRoutineBtn" class="tappable focus-ring px-3 py-2 rounded bg-[color:var(--copper)] text-white font-semibold">+ Nova Rotina</button>
      </div>
      <div id="routineList" class="space-y-4"><!-- cards --></div>
    </div>
  </section>

  <!-- CALENDÁRIO -->
  <section id="calendarScreen" class="hidden flex-1 w-full mx-auto max-w-screen-md px-4 sm:px-6 py-4">
    <div class="card p-5 sm:p-6 w-full">
      <div class="flex items-center justify-between mb-3 gap-2">
        <button id="prevMonth" class="tappable focus-ring p-2 rounded hover:bg-black/5 dark:hover:bg-white/10" title="Mês anterior">
          <svg class="icon" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <h2 id="monthTitle" class="title-xl font-semibold">Mês Ano</h2>
        <button id="nextMonth" class="tappable focus-ring p-2 rounded hover:bg-black/5 dark:hover:bg-white/10" title="Próximo mês">
          <svg class="icon" viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg>
        </button>
      </div>

      <div class="grid grid-cols-7 gap-1 text-center text-xs text-gray-600 dark:text-gray-300 mb-2">
        <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div>
      </div>
      <div id="calendarGrid" class="grid grid-cols-7 gap-1 mb-6"><!-- dias --></div>

      <form id="eventForm" class="grid sm:grid-cols-3 gap-2">
        <input id="eventTitle" required placeholder="Título" class="focus-ring px-3 py-2 rounded border outline-none"/>
        <input id="eventDate" type="date" required class="focus-ring px-3 py-2 rounded border outline-none"/>
        <div class="flex gap-2">
          <input id="eventTime" type="time" class="focus-ring px-3 py-2 rounded border outline-none flex-1"/>
          <button class="tappable focus-ring px-3 py-2 rounded bg-[color:var(--copper)] text-white font-semibold whitespace-nowrap" type="submit">Adicionar</button>
        </div>
      </form>

      <div class="mt-5">
        <h3 class="font-semibold mb-2">Próximos eventos</h3>
        <div id="eventList" class="space-y-2"></div>
      </div>
    </div>
  </section>

  <!-- CONFIG -->
  <section id="settingsScreen" class="hidden flex-1 w-full mx-auto max-w-screen-md px-4 sm:px-6 py-4">
    <div class="card p-5 sm:p-6">
      <h2 class="title-xl font-semibold mb-4">Configurações</h2>
      <div class="space-y-4">
        <div class="flex items-center justify-between">
          <span>Modo Escuro</span>
          <button id="themeToggleSettings" class="tappable focus-ring p-2 rounded" title="Alternar tema">
            <svg class="icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          </button>
        </div>
        <div class="flex items-center justify-between">
          <span>Idioma</span>
          <button id="langToggleSettings" class="tappable focus-ring px-3 py-1.5 rounded border-2 border-[color:var(--copper)] text-[color:var(--copper)]">EN/PT</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Bottom Nav -->
  <nav class="bg-white dark:bg-[#111] border-t border-gray-200 dark:border-white/10 safe-bottom">
    <div class="mx-auto w-full max-w-screen-md px-4 sm:px-6 py-2 flex items-center justify-around">
      <button id="navHome" class="tappable focus-ring p-2 rounded text-[color:var(--copper)]" title="Início">
        <svg class="icon" viewBox="0 0 24 24"><path d="M3 10.5L12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1v-10.5z"/></svg>
      </button>
      <button id="navRoutine" class="tappable focus-ring p-2 rounded text-gray-400" title="Rotinas">
        <svg class="icon" viewBox="0 0 24 24"><path d="M8 6h13M3 6h.01M8 12h13M3 12h.01M8 18h13M3 18h.01"/></svg>
      </button>
      <button id="navCalendar" class="tappable focus-ring p-2 rounded text-gray-400" title="Calendário">
        <svg class="icon" viewBox="0 0 24 24"><path d="M8 2v4M16 2v4M3 10h18M5 6h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"/></svg>
      </button>
      <button id="navSettings" class="tappable focus-ring p-2 rounded text-gray-400" title="Configurações">
        <svg class="icon" viewBox="0 0 24 24"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06A1.65 1.65 0 0 0 15 19.4a1.65 1.65 0 0 0-1 .6 1.65 1.65 0 0 0-.33 1.82 2 2 0 1 1-3.34 0A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82-.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-.6-1 1.65 1.65 0 0 0-1.82-.33 2 2 0 1 1 0-3.34A1.65 1.65 0 0 0 4.6 9c.23.26.36.62.36 1s-.13.74-.36 1z"/></svg>
      </button>
    </div>
  </nav>

  <script>
    /* ---------------- Persistência ---------------- */
    const store = {
      get(k,f){ try{return JSON.parse(localStorage.getItem(k)) ?? f}catch{return f} },
      set(k,v){ localStorage.setItem(k, JSON.stringify(v)) }
    };

    /* ---------------- Tema & Idioma ---------------- */
    const body = document.body;
    const themeToggle = document.getElementById('themeToggle');
    const themeToggleSettings = document.getElementById('themeToggleSettings');
    const langToggle = document.getElementById('langToggle');
    const langToggleSettings = document.getElementById('langToggleSettings');

    function setDarkMode(on){
      body.classList.toggle('dark-mode', on);
      localStorage.setItem('darkMode', on ? 'true':'false');
      themeToggle.innerHTML = on
        ? `<svg class="icon" viewBox="0 0 24 24"><path d="M12 3v2M12 19v2M5 12H3M21 12h-2M5.64 5.64L4.22 4.22M19.78 19.78l-1.42-1.42M5.64 18.36L4.22 19.78M19.78 4.22l-1.42 1.42"/></svg>`
        : `<svg class="icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>`;
    }
    setDarkMode(localStorage.getItem('darkMode')==='true');
    themeToggle.addEventListener('click',()=> setDarkMode(!body.classList.contains('dark-mode')));
    themeToggleSettings?.addEventListener('click',()=> setDarkMode(!body.classList.contains('dark-mode')));

    /* ---------------- Navegação ---------------- */
    const screens = {
      home: document.getElementById('homeScreen'),
      routine: document.getElementById('routineScreen'),
      calendar: document.getElementById('calendarScreen'),
      settings: document.getElementById('settingsScreen')
    };
    const navButtons = {
      navHome: document.getElementById('navHome'),
      navRoutine: document.getElementById('navRoutine'),
      navCalendar: document.getElementById('navCalendar'),
      navSettings: document.getElementById('navSettings')
    };
    function setActiveNav(id){
      Object.keys(navButtons).forEach(k=>{
        navButtons[k].classList.toggle('text-[color:var(--copper)]', k===id);
        navButtons[k].classList.toggle('text-gray-400', k!==id);
      });
    }
    function showScreen(which){
      Object.values(screens).forEach(s=>s.classList.add('hidden'));
      screens[which].classList.remove('hidden');
      setActiveNav('nav'+which.charAt(0).toUpperCase()+which.slice(1));
    }
    navButtons.navHome.addEventListener('click',()=>showScreen('home'));
    navButtons.navRoutine.addEventListener('click',()=>showScreen('routine'));
    navButtons.navCalendar.addEventListener('click',()=>showScreen('calendar'));
    navButtons.navSettings.addEventListener('click',()=>showScreen('settings'));
    showScreen('home');

    /* ---------------- Frases ---------------- */
    const quotes = [
      {text:'O segredo para avançar é começar.', author:'Mark Twain'},
      {text:'Disciplina vence a motivação.', author:'—'},
      {text:'Comece pequeno. Vença hoje.', author:'—'},
    ];
    const q = quotes[(new Date()).getDate() % quotes.length];
    document.getElementById('quoteText').textContent = `“${q.text}”`;
    document.getElementById('quoteAuthor').textContent = `— ${q.author}`;

    /* ---------------- Rotina Matinal (HOME) ---------------- */
    let morning = store.get('morningChecklist', [
      {id:'1', label:"Beber um copo d'água", done:false},
      {id:'2', label:'Alongamento de 5 minutos', done:false},
      {id:'3', label:'Escrever no diário por 5 minutos', done:false},
      {id:'4', label:'Ler 10 páginas', done:false},
    ]);
    const morningList = document.getElementById('morningList');
    const progressFill = document.getElementById('routineProgress');

    function renderMorning(){
      morningList.innerHTML = morning.map(item => `
        <li class="flex items-center justify-between gap-2 p-2 rounded hover:bg-black/5 dark:hover:bg-white/10" data-id="${item.id}">
          <label class="flex items-center gap-3 flex-1">
            <input type="checkbox" ${item.done?'checked':''} class="h-5 w-5" data-action="toggle">
            <span class="${item.done?'line-through text-gray-500':''}">${item.label}</span>
          </label>
          <button class="tappable focus-ring p-2 rounded text-red-600" data-action="delete" title="Excluir">
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 6h18M8 6v12m8-12v12M10 6l1-2h2l1 2"/></svg>
          </button>
        </li>`).join('');
      const completed = morning.filter(t=>t.done).length;
      const pct = morning.length ? (completed/morning.length)*100 : 0;
      progressFill.style.width = pct + '%';
    }
    renderMorning();

    // Delegation para excluir / marcar
    morningList.addEventListener('click',(e)=>{
      const li = e.target.closest('li'); if(!li) return;
      const id = li.dataset.id;
      const actionBtn = e.target.closest('[data-action]');
      if(!actionBtn) return;
      const action = actionBtn.dataset.action;

      if(action==='toggle'){
        const item = morning.find(x=>x.id===id);
        item.done = !item.done;
        store.set('morningChecklist', morning);
        renderMorning();
      }
      if(action==='delete'){
        morning = morning.filter(x=>x.id!==id);
        store.set('morningChecklist', morning);
        renderMorning();
      }
    });

    document.getElementById('addMorningTask').addEventListener('click',()=>{
      const name = prompt('Novo item da rotina matinal:');
      if(name && name.trim()){
        morning.push({id:Date.now().toString(), label:name.trim(), done:false});
        store.set('morningChecklist', morning); renderMorning();
      }
    });

    /* ---------------- Planner (HOME) ---------------- */
    let planner = store.get('planner', {
      morning:[{id:'m1',label:'Revisar metas diárias',done:false},{id:'m2',label:'Reunião de equipe às 10:00',done:false}],
      afternoon:[{id:'a1',label:'Trabalhar na proposta do projeto',done:false}],
      evening:[{id:'e1',label:'Planejar agenda de amanhã',done:false},{id:'e2',label:'Ler antes de dormir',done:false}]
    });

    const lists = {
      morning: document.getElementById('planMorning'),
      afternoon: document.getElementById('planAfternoon'),
      evening: document.getElementById('planEvening')
    };
    function renderPlan(period){
      lists[period].innerHTML = planner[period].map(task=>`
        <li class="flex items-center justify-between gap-2 p-2 rounded hover:bg-black/5 dark:hover:bg-white/10" data-id="${task.id}">
          <label class="flex items-center gap-3 flex-1">
            <input type="checkbox" ${task.done?'checked':''} class="h-5 w-5" data-action="toggle">
            <span class="${task.done?'line-through text-gray-500':''}">${task.label}</span>
          </label>
          <button class="tappable focus-ring p-2 rounded text-red-600" data-action="delete" title="Excluir">
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 6h18M8 6v12m8-12v12M10 6l1-2h2l1 2"/></svg>
          </button>
        </li>`).join('');
    }
    ['morning','afternoon','evening'].forEach(renderPlan);

    // Delegation para cada UL do planner
    Object.values(lists).forEach(ul=>{
      ul.addEventListener('click',(e)=>{
        const li = e.target.closest('li'); if(!li) return;
        const id = li.dataset.id;
        const period = ul.dataset.period;
        const btn = e.target.closest('[data-action]'); if(!btn) return;
        const action = btn.dataset.action;

        if(action==='toggle'){
          const item = planner[period].find(x=>x.id===id);
          item.done = !item.done;
          store.set('planner', planner); renderPlan(period);
        }
        if(action==='delete'){
          planner[period] = planner[period].filter(x=>x.id!==id);
          store.set('planner', planner); renderPlan(period);
        }
      });
    });

    // Botões de adicionar por período
    document.querySelectorAll('[data-add]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const period = btn.getAttribute('data-add');
        const name = prompt(`Nova tarefa (${period}):`);
        if(name && name.trim()){
          planner[period].push({id:period[0]+Date.now(), label:name.trim(), done:false});
          store.set('planner', planner); renderPlan(period);
        }
      });
    });

    /* ---------------- Rotinas (tela) ---------------- */
    let routines = store.get('routines', [
      {id:'r1', name:'Rotina Matinal Básica', items:[
        {id:'r1t1',label:'Acordar às 6:00',done:false},
        {id:'r1t2',label:'Beber água',done:false},
        {id:'r1t3',label:'Meditar 10 minutos',done:false},
      ]},
      {id:'r2', name:'Exercícios Matinais', items:[
        {id:'r2t1',label:'Alongamento',done:false},
        {id:'r2t2',label:'20 polichinelos',done:false},
        {id:'r2t3',label:'Flexões',done:false},
      ]}
    ]);
    const routineList = document.getElementById('routineList');

    function renderRoutines(){
      routineList.innerHTML = routines.map(r=>`
        <article class="border border-gray-200 dark:border-white/10 rounded-2xl p-4" data-rid="${r.id}">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold">${r.name}</h3>
            <div class="flex gap-2">
              <button class="tappable focus-ring px-3 py-1.5 rounded border-2 border-[color:var(--copper)] text-[color:var(--copper)]" data-action="add-item">+ Item</button>
              <button class="tappable focus-ring px-3 py-1.5 rounded text-red-600 border-2 border-red-600" data-action="del-routine">Excluir</button>
            </div>
          </div>
          <ul class="space-y-2">
            ${r.items.map(it=>`
              <li class="flex items-center justify-between gap-2 p-2 rounded hover:bg-black/5 dark:hover:bg-white/10" data-iid="${it.id}">
                <label class="flex items-center gap-3 flex-1">
                  <input type="checkbox" ${it.done?'checked':''} class="h-5 w-5" data-action="toggle-item">
                  <span class="${it.done?'line-through text-gray-500':''}">${it.label}</span>
                </label>
                <button class="tappable focus-ring p-2 rounded text-red-600" data-action="del-item" title="Excluir">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M3 6h18M8 6v12m8-12v12M10 6l1-2h2l1 2"/></svg>
                </button>
              </li>`).join('')}
          </ul>
        </article>
      `).join('');
    }
    renderRoutines();

    // Delegation na área de rotinas
    routineList.addEventListener('click',(e)=>{
      const card = e.target.closest('article[data-rid]'); if(!card) return;
      const rid = card.dataset.rid;
      const btn = e.target.closest('[data-action]'); if(!btn) return;
      const action = btn.dataset.action;

      const r = routines.find(x=>x.id===rid);

      if(action==='add-item'){
        const name = prompt('Novo item da rotina:');
        if(name && name.trim()){
          r.items.push({id: rid+'_'+Date.now(), label:name.trim(), done:false});
          store.set('routines', routines); renderRoutines();
        }
      }
      if(action==='del-routine'){
        routines = routines.filter(x=>x.id!==rid);
        store.set('routines', routines); renderRoutines();
      }
      if(action==='toggle-item'){
        const li = e.target.closest('li[data-iid]'); if(!li) return;
        const iid = li.dataset.iid;
        const it = r.items.find(i=>i.id===iid);
        it.done = !it.done;
        store.set('routines', routines); renderRoutines();
      }
      if(action==='del-item'){
        const li = e.target.closest('li[data-iid]'); if(!li) return;
        const iid = li.dataset.iid;
        r.items = r.items.filter(i=>i.id!==iid);
        store.set('routines', routines); renderRoutines();
      }
    });

    document.getElementById('addRoutineBtn').addEventListener('click',()=>{
      const name = prompt('Nome da nova rotina:');
      if(name && name.trim()){
        routines.push({id:'r'+Date.now(), name:name.trim(), items:[]});
        store.set('routines', routines); renderRoutines();
      }
    });

    /* ---------------- Calendário ---------------- */
    const monthTitle = document.getElementById('monthTitle');
    const calendarGrid = document.getElementById('calendarGrid');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');
    let current = new Date(); current.setDate(1);

    let events = store.get('events', []); // {id,title,date:'YYYY-MM-DD',time}

    function yyyyMMdd(d){ const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0'); return `${d.getFullYear()}-${m}-${day}`; }

    function renderEventsList(){
      const list = document.getElementById('eventList');
      const upcoming = [...events].sort((a,b)=>a.date.localeCompare(b.date));
      list.innerHTML='';
      if(!upcoming.length){ list.innerHTML='<p class="text-sm text-gray-500">Nenhum evento.</p>'; return; }
      upcoming.forEach(ev=>{
        const row = document.createElement('div');
        row.className = 'flex items-center justify-between p-2 rounded border border-gray-200 dark:border-white/10';
        row.innerHTML = `
          <div>
            <div class="font-semibold">${ev.title}</div>
            <div class="text-sm text-gray-600 dark:text-gray-300">${ev.date}${ev.time?(' • '+ev.time):''}</div>
          </div>
          <button class="tappable focus-ring p-2 rounded text-red-600" data-id="${ev.id}" title="Excluir">
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 6h18M8 6v12m8-12v12M10 6l1-2h2l1 2"/></svg>
          </button>
        `;
        row.querySelector('button').addEventListener('click',()=>{
          events = events.filter(e=>e.id!==ev.id);
          store.set('events', events); renderCalendar(); renderEventsList();
        });
        list.appendChild(row);
      });
    }

    function renderCalendar(){
      const monthNames=['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
      monthTitle.textContent = `${monthNames[current.getMonth()]} ${current.getFullYear()}`;
      calendarGrid.innerHTML='';

      const first = new Date(current.getFullYear(), current.getMonth(), 1).getDay();
      const daysInMonth = new Date(current.getFullYear(), current.getMonth()+1, 0).getDate();

      for(let i=0;i<first;i++){
        const cell=document.createElement('div'); cell.className='h-10 sm:h-12'; calendarGrid.appendChild(cell);
      }
      for(let d=1; d<=daysInMonth; d++){
        const date = new Date(current.getFullYear(), current.getMonth(), d);
        const iso = yyyyMMdd(date);
        const hasEvent = events.some(e=>e.date===iso);
        const isToday = iso===yyyyMMdd(new Date());
        const cell=document.createElement('div');
        cell.className = `h-10 sm:h-12 p-2 rounded text-sm flex flex-col items-center justify-center border
                          ${isToday?'bg-[color:var(--copper)] text-white border-[color:var(--copper)]':'bg-white dark:bg-[#1E1E1E] border-gray-200 dark:border-white/10'}`;
        cell.innerHTML = `
          <div class="font-medium">${d}</div>
          ${hasEvent?'<span class="w-1.5 h-1.5 rounded-full bg-[color:var(--copper)] mt-1"></span>':''}
        `;
        // clicar no dia preenche a data no formulário
        cell.addEventListener('click',()=>{
          document.getElementById('eventDate').value = iso;
          document.getElementById('eventTitle').focus();
        });
        calendarGrid.appendChild(cell);
      }
    }
    document.getElementById('prevMonth').addEventListener('click',()=>{ current.setMonth(current.getMonth()-1); renderCalendar(); });
    document.getElementById('nextMonth').addEventListener('click',()=>{ current.setMonth(current.getMonth()+1); renderCalendar(); });
    renderCalendar(); renderEventsList();

    document.getElementById('eventForm').addEventListener('submit',(e)=>{
      e.preventDefault();
      const title = document.getElementById('eventTitle').value.trim();
      const date  = document.getElementById('eventDate').value;
      const time  = document.getElementById('eventTime').value;
      if(!title || !date) return;
      events.push({id:Date.now().toString(), title, date, time: time||''});
      store.set('events', events);
      e.target.reset();
      renderCalendar(); renderEventsList();
    });

    /* ---------------- Idioma (básico) ---------------- */
    let currentLang='pt';
    function setLang(l){
      currentLang=l;
      document.querySelector('header h1').textContent = l==='pt' ? 'Café Matinal' : 'Morning Brew';
    }
    langToggle.addEventListener('click',()=> setLang(currentLang==='pt'?'en':'pt'));
    langToggleSettings.addEventListener('click',()=> setLang(currentLang==='pt'?'en':'pt'));

    /* ---------------- Notificações (simulado, 1x) ---------------- */
    if(!localStorage.getItem('notificationRequested')){
      setTimeout(()=>{
        if(confirm('Café Matinal deseja enviar lembretes diários. Permitir?')){
          alert('Lembretes ativados! Você receberá sua primeira mensagem amanhã de manhã.');
        }
        localStorage.setItem('notificationRequested','true');
      }, 2400);
    }
  </script>
</body>
</html>
